<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galleri</title>
    <link rel="stylesheet" href="styleGallery.css">
    <link rel="icon" type="image/x-icon" href="../assets/images/logo.ico">

    <style>
        /* --- Security Styles --- */
        /* This ensures the page is blank until we verify the user */
        #access-denied {
            display: none;
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #f4f4f4;
            font-family: sans-serif;
            padding: 20px;
        }

        /* Hide the main website content by default */
        #main-content {
            display: none;
        }
    </style>
</head>

<body>

    <div id="access-denied">
        <h1>Adgang nægtet</h1>
        <p>Vi kunne ikke finde din invitation.</p>
        <p>Gå venligst tilbage til forsiden eller scan din QR-kode igen.</p>
    </div>

    <div id="main-content">
        <main>
            <section class="hero">
                <div class="hero-header">
                    <a href="../" class="header-icon-link">
                        <img src="../assets/images/logo.png" alt="Site Icon" class="header-icon">
                    </a>

                    <nav class="navbar">
                        <button class="burger-button" id="burger-toggle">
                            <span class="burger-line"></span>
                            <span class="burger-line"></span>
                            <span class="burger-line"></span>
                        </button>

                        <ul>
                            <li><a href="../">Brylluppet</a></li>
                            <li><a href="../Information/">Praktisk information</a></li>
                            <li class="active"><a href="index.html">Galleri</a></li>
                            <li><a href="../RSVP/">RSVP</a></li>
                        </ul>
                    </nav>
                </div>
            </section>

            <div class="spacer layer1"></div>

            <section class="content">
                <h2>Billedgalleri</h2>

                <p>
                    Her vil vi uploade billeder fra brylluppet og give mulighed for at I kan uploade jeres.
                </p>
            </section>

        </main>

        <footer>
            <p>© 2025 Anne & Torben. All rights reserved.</p>
        </footer>
    </div>


    <script src="../script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const params = new URLSearchParams(window.location.search);
            const uid = params.get("uid");

            const mainContent = document.getElementById("main-content");
            const accessDenied = document.getElementById("access-denied");

            // --- SECURITY CHECK ---

            // 1. If no UID in URL, deny access immediately
            if (!uid) {
                showAccessDenied();
                return;
            }

            try {
                // 2. Fetch the guest list to verify ID
                const response = await fetch("../assets/guest.json");
                if (!response.ok) throw new Error("JSON not found");

                const guests = await response.json();

                // 3. Verify if ID exists in the JSON
                if (guests[uid]) {
                    // === ACCESS GRANTED ===

                    // Show the page content
                    accessDenied.style.display = "none";
                    mainContent.style.display = "flex";

                    // Update all navigation links to include the UID
                    updateLinks(uid);

                } else {
                    // === ACCESS DENIED (Invalid ID) ===
                    showAccessDenied();
                }
            } catch (err) {
                console.error("Security verification failed:", err);
                // In case of technical error, default to Access Denied
                showAccessDenied();
            }

            // --- HELPER FUNCTIONS ---

            function showAccessDenied() {
                mainContent.style.display = "none";
                accessDenied.style.display = "flex";
            }

            function updateLinks(validUid) {
                document.querySelectorAll("a").forEach(link => {
                    const href = link.getAttribute("href");

                    // Skip external links, mailto, or empty links
                    if (!href || href.startsWith("mailto:") || (href.startsWith("http") && !href.includes("index.html"))) {
                        return;
                    }

                    try {
                        const url = new URL(link.href, window.location.origin);
                        url.searchParams.set("uid", validUid);
                        link.href = url.toString();
                    } catch (e) {
                        console.log("Skipping link:", href);
                    }
                });
            }

            // --- BURGER MENU LOGIC ---
            const burgerToggle = document.getElementById("burger-toggle");
            const navLinks = document.querySelector(".navbar ul");

            if (burgerToggle && navLinks) {
                const closeMenu = () => {
                    navLinks.classList.remove("nav-active");
                    burgerToggle.classList.remove("burger-active");
                };

                const toggleMenu = () => {
                    navLinks.classList.toggle("nav-active");
                    burgerToggle.classList.toggle("burger-active");
                };

                burgerToggle.addEventListener("click", toggleMenu);

                // Close when clicking the overlay background
                navLinks.addEventListener("click", (e) => {
                    if (e.target === navLinks) {
                        closeMenu();
                    }
                });
            }
        });
    </script>

</body>

</html>
